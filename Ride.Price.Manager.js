// Mod powered by https://github.com/wisnia74/openrct2-typescript-mod-template - MIT license
!(function(){'use strict';var e='RidePriceManager.',t=e+'goodValueEnabled',n=e+'ignoreFreeRidesEnabled',i=e+'lazyTaxFactor',r=e+'pluginEnabled',o=e+'unboundPriceEnabled',c=!1,a=!0,u=0,d=!0,s=!1,f=[{s:'0%',n:0},{s:'5%',n:.05},{s:'10%',n:.1},{s:'15%',n:.15},{s:'20%',n:.2},{s:'30%',n:.3},{s:'40%',n:.4},{s:'50%',n:.5}],l=function(){return context.sharedStorage.get(t,c)},g=function(e){return context.sharedStorage.set(t,e)},h=function(){return context.sharedStorage.get(n,a)},p=function(e){return context.sharedStorage.set(n,e)},m=function(){return context.sharedStorage.get(i,u)},R=function(e){return context.sharedStorage.set(i,e)},x=function(){return context.sharedStorage.get(r,d)},P=function(e){return context.sharedStorage.set(r,e)},y=function(){return context.sharedStorage.get(o,s)},b=function(e){return context.sharedStorage.set(o,e)},k=(function(){function e(){}return e.updateRidePrices=function(){x()&&map.rides.map((function(t){0===t.price[0]&&h()||e.setRidePrice(t)}))},e.forceUpdateRidePrices=function(){map.rides.map((function(t){return e.setRidePrice(t)}))},e.makeRidesFree=function(){map.rides.map((function(t){return e.setRidePrice(t,0)}))},e.setRidePrice=function(t,n){e.isOpenAndRatedRide(t)&&(void 0===n&&(n=e.calculateRidePrice(t)),context.executeAction('ridesetprice',{ride:t.id,price:n,isPrimaryPrice:!0},(function(){})))},e.isOpenAndRatedRide=function(e){return'ride'===e.classification&&'open'===e.status&&-1!==e.excitement},e.calculateRidePrice=function(e){var t=park.entranceFee>0&&!park.getFlag('freeParkEntry')?Math.floor(e.value/4):e.value,n=l()?Math.floor(t/2):2*t;return m()>0&&(n*=1-m(),n=Math.floor(n)),y()||(n=Math.min(n,200)),n},e})(),v='ride_management',w=decodeURI('%E2%80%9C'),E=decodeURI('%E2%80%9D');function M(e,t,n,i,r){return{type:'checkbox',x:5,y:e,width:210,height:10,tooltip:t,text:n,isChecked:i,onChange:r}}function F(e){return M(e,'Prevent the plugin from affecting rides that are currently free. Recommended for transport rides & scenarios with a Park Entrance Fee.','Ignore free rides',h(),(function(e){p(e)}))}function S(e){return M(e,'Charge 1/4 as much so guests think your rides are good value','Enable '+w+'Good Value'+E+' Pricing',l(),(function(e){g(e)}))}function I(e){return{type:'label',x:5,y:e,width:210,height:10,tooltip:'Reduce prices to compensate for the assistance the plugin gives',text:w+'Lazy Tax'+E,onChange:function(){}}}function C(e){return{type:'dropdown',x:72,y:e,width:40,height:13,items:f.map((function(e){return e.s})),selectedIndex:f.map((function(e){return e.n})).indexOf(m()),onChange:function(e){R(f[e].n)}}}function A(e){return M(e,'Via the UI, the max price is $20.00 - Enable this to allow the plugin to set higher prices','Allow unbound prices',y(),(function(e){b(e)}))}function U(e,t,n,i){return{type:'button',x:5,y:e,width:230,height:21,text:n,tooltip:t,isPressed:!1,onClick:i}}function L(e){return U(e,'Immediately set the price for all rides, overriding the "Ignore Free" preference','Force Recalculate ALL Prices Now',k.forceUpdateRidePrices)}function T(e){return U(e,'Immediately make all rides free.','Make ALL Rides FREE',k.makeRidesFree)}registerPlugin({name:'Ride Price Manager',version:'1.3.2',authors:['mgovea','Sadret','kscheel'],type:'remote',licence:'MIT',main:function(){'undefined'!=typeof ui&&ui.registerMenuItem('Ride Price Manager',(function(){!(function(){var e=ui.getWindow(v);if(e)e.bringToFront();else{var t,n={classification:v,width:240,height:159,title:'Ride Price Manager',widgets:[(t=20,M(t,'Unchecking completely disables the plugin','Enable automatic Ride Price Management',x(),(function(e){P(e)}))),F(45),S(60),I(75),C(75),A(92),L(107),T(132)]};ui.openWindow(n)}})()})),'client'!==network.mode&&(context.subscribe('interval.day',(function(){k.updateRidePrices()})),k.updateRidePrices())}})})();
